'use strict'

const express = require('express')
const {context, candidateContext} = require('../middleware/context-manager')

const router = express.Router()
const LOG_NS = '[CANDIDATE-ROUTE]'
const BASE_PATH = '/candidate'

router.get(BASE_PATH + '/:candidateId', getCandidate)

router.param('candidateId', candidateContext(true))

/**
 * gets a position
 * @param req
 * @param res
 * @returns {Promise<void>}
 */
async function getCandidate(req, res) {

  try {
    let position = await context.position()
    let candidate = await context.candidate()

    console.log(LOG_NS, candidate)

    res.send(position)
  } catch (e) {
    console.error(LOG_NS, 'Error retrieving position', e)
    res.status(400).send('Something bad happened')
  }
}

module.exports = router
