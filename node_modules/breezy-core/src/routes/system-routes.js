'use strict'

const express = require('express')

const path = require('path')
const resource = path.join(__dirname, '../../', 'resources')
const {context, positionContext, companyContext} = require('../middleware/context-manager')

const router = express.Router()
const LOG_NS = '[SYSTEM]'

router.use("/test", express.static(resource))

router.get('/health', healthCheck)

router.get('/context', companyContext(), positionContext(), contextCheck)


/**
 * Simple route check
 * @param req
 * @param res
 */
function healthCheck(req, res) {

  console.log(LOG_NS, 'A-O-K')
  res.sendStatus(200);
}

async function contextCheck(req, res) {

  let user = await context.user()
  let company = await context.company()
  let security = await context.security()
  let position = await context.position()

  console.log(LOG_NS, 'user', user)
  console.log(LOG_NS, 'company', company)
  console.log(LOG_NS, 'security', security)
  console.log(LOG_NS, 'position', position)

  res.sendStatus(200);
}

module.exports = router
