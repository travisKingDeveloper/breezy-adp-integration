'use strict'

module.exports = {
  mapSeries: mapSeries
}

/**
 * Tests if an object is iterable
 * @param {object} obj
 * @returns {boolean}
 */
function _isIterable(obj) {

  if (obj == null) {
    return false;
  }
  return typeof obj[Symbol.iterator] === 'function';
}

/**
 *
 * @param {Iterable} iterable
 * @param {Function} fn
 * @returns {Promise<Array>}
 */
async function mapSeries(iterable, fn) {

  let result = []
  let index = 0;

  if (_isIterable(iterable)) {

    for (let item of iterable) {
      let itemResult = await item
      if (fn) {
        result.push(fn(itemResult, index))
      } else {
        result.push(itemResult)
      }
      index++
    }
    return Promise.all(result)

  } else {
    throw new Error(`Input must be Iterable`)
  }
}