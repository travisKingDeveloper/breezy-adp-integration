'use strict';

const breezyConfig = require('../../data/config')
require('../util/breezy-config').initConfig(breezyConfig)
const {trace} = require('./logger')(breezyConfig)
const {requestContext} = require('../middleware/context-manager')
const express = require('express')
const LOG_NS = '[EXPRESS]'

class Server {

  /**
   * @param {number} port
   */
  constructor(port) {

    this._port = port
    this._server = express()
    this._server.use(trace.expressMiddleware({
      useHeader: true
    }))
    this._server.use(requestContext())
    this._instance = null;
  }

  /**
   * Starts the server
   */
  start() {
    this._instance = this._server.listen(this._port, () => console.log(LOG_NS, `Breezy-Ultra-Mega-Super-Lite listening on port ${this._port}!`))
  }

  /**
   * Attaches routes to the server
   * @param base
   * @param route
   */
  useRoutes(base, route) {
    this._server.use(base, route)
  }

  /**
   * Shuts it down, turns off the lights and locks the doors
   */
  shutdown() {
    this._instance.close()
  }

}

module.exports = Server

