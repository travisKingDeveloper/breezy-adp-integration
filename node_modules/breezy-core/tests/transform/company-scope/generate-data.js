'use strict'

const breezyConfig = require('../../../data/config')
require('../../../src/util/breezy-config').initConfig(breezyConfig)
const mongo = require('../../../src/db/mongoClient')()
const helpers = require('../../../src/util/helpers')
const scopeClient = require('../../../src/lib/security/core-scope')


const roles = ['manager', 'position_member']

async function main() {

  await mongo

  //await scopeClient.addMemberToPosition('e16af8b6eb68', 'ba7b7b8a9080', '08cf60071ead', 'manager')

  for (let c = 0; c < 500; c++) {

    console.log('')
    let companyId = helpers.getId()
    let members = []
    let teams = []

    console.log('Creating company', c, companyId)

    let memberCount = 5 + getRandomInt(30)
    console.log('Creating', memberCount, 'members for company', companyId)

    for (let m = 0; m < memberCount; m++) {
      members.push(helpers.getId())
    }

    let teamCount = getRandomInt(10)
    console.log('Creating', teamCount, 'teams for company', companyId)

    for (let m = 0; m < teamCount; m++) {
      teams.push(helpers.getId())
    }

    let positionCount = 50 + getRandomInt(1000)
    console.log('Creating', positionCount, 'positions for company', companyId)
    for (let p = 0; p < positionCount; p++) {
      let positionId = helpers.getId(companyId)

      for (let i = 0; i < members.length; i++) {
        if (getRandomInt(2) === 0) {
          await scopeClient.addMemberToPosition(companyId, positionId, members[i], applyRole())
        }
      }

      for (let i = 0; i < teams.length; i++) {
        if (getRandomInt(2) === 0) {
          await scopeClient.addTeamToPosition(companyId, positionId, teams[i], applyRole())
        }
      }
    }
    console.log('done')
  }
}

let relations = [{
  _id: '5d67bd18bc01ce75ab2e0f99',
  company_id: '0fbde5654c03',
  position_id: '8b8e6f521e8b',
  role: 'position_member',
  members: ['298cd7d79bb8', 'fa5217abe869', '4aab450228cb'],
  teams: ['1b894bdada9a']
}, {
  _id: '5d67bd18bc01ce75ab2e0fa0',
  company_id: '0fbde5654c03',
  position_id: '47f9271f9bf2',
  role: 'manager',
  members: ['a3119394ea07', 'b70dd703ba78', '298cd7d79bb8']
}, {
  _id: ' 5d67bd18bc01ce75ab2e0fb7',
  company_id: '0fbde5654c03',
  position_id: '1391896b53cf',
  role: 'position_member',
  members: ['298cd7d79bb8'],
  teams:
    ['d926ff912ea5', '1b894bdada9a', '88dd90cb2a80', '919d46abd0f2']
}, {
  _id: ' 5d67bd18bc01ce75ab2e0fc9',
  company_id: '0fbde5654c03',
  position_id: '086d9295d49d',
  role: 'manager',
  members:
    ['a3119394ea07',
      'b70dd703ba78',
      '298cd7d79bb8',
      'e211df5ae196',
      '2c8428099914'],
  teams: ['919d46abd0f2']
}, {
  _id: '5d67bd18bc01ce75ab2e0fd3',
  company_id: '0fbde5654c03',
  position_id: 'aecf151b12ed',
  role: 'position_member',
  members:
    ['a3119394ea07', '298cd7d79bb8', 'ad22b6d809a6', '2c8428099914']
}, {
  _id: '5d67bd18bc01ce75ab2e0fe1',
  company_id: '0fbde5654c03',
  position_id: 'bac8264a964b',
  role: 'manager',
  members:
    ['298cd7d79bb8', 'e211df5ae196', 'fa5217abe869', '4aab450228cb'],
  teams: ['919d46abd0f2']
}]

function applyRole() {
  return roles[getRandomInt(2)]
}

function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}


setTimeout(main, 1500);

// main().then(() => {
//   console.log('Done');
// }).catch((e) => {
//   console.error(e);
// });
