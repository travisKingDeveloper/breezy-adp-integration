'use strict'

const securityConfig = require('../../data/security-config')
const {securityRequirement} = require('../../src/security/access-manager')

async function main() {

  let data = 'CONSTANT,KEY,SCOPE,CATEGORY'
  for (let role of securityConfig.defaultRoles) {
    data += ',' + role._id
  }
  data += '\n'

  for (let perm in securityConfig.PERMISSION) {
    if (securityConfig.PERMISSION[perm].length > 0) {
      data += perm
      data += ',' + securityConfig.PERMISSION[perm]
      for (let permDef of securityConfig.permissions) {
        if (permDef._id === securityConfig.PERMISSION[perm]) {
          data += ',' + permDef.type
          data += ',' + permDef.category
        }
      }
      for (let role of securityConfig.defaultRoles) {
        let value = ''
        for (let rolePerm of role.permissions) {
          if (rolePerm._id === securityConfig.PERMISSION[perm]) {
            value = securityRequirement(rolePerm.access)
          }
        }
        if (value) {
          let val = value
          if (value < 10) {
            val += ' '
          }
          data += ',' + val + ': '
          if (value & 1) {
            data += 'C '
          } else {
            data += '--'
          }
          if (value & 2) {
            data += 'R '
          } else {
            data += '--'
          }
          if (value & 4) {
            data += 'U '
          } else {
            data += '--'
          }
          if (value & 8) {
            data += 'D '
          } else {
            data += '--'
          }
        } else {
          data += ',------------'
        }
      }
      data += '\n'
    }
  }

  console.log(data)
}

main().then(() => {
  console.log('Done');
}).catch((e) => {
  console.error(e);
});
