'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var SCOPE_ALL="all_scopes";function _validateAgainst(a,b,c){return(c&b)===c}var AccessManager=function(){function a(b){_classCallCheck(this,a),this._user_id=b.userId,this._company_id=b.companyId,this._roles=b.roles,this._positionRoles=b.positionRoles,this._permissions=b.permissions}return _createClass(a,[{key:"userCan",value:function(a,b,c){var d=b.create,e=void 0===d?0:d,f=b.read,g=void 0===f?0:f,h=b.update,i=void 0===h?0:h,j=b.remove,k=void 0===j?0:j,l=0;if(c){var m=this._getRoles(c),n=!0,o=!1,p=void 0;try{for(var q,r=m[Symbol.iterator]();!(n=(q=r.next()).done);n=!0){var s=q.value,t=this._permissions[s][a];l=mergePermissions(l,t)}}catch(a){o=!0,p=a}finally{try{!n&&r.return&&r.return()}finally{if(o)throw p}}}return!!(this._permissions&&0!==this._permissions.size)&&!!(a&&(a in this._permissions||0!==l))&&(l=mergePermissions(l,this._permissions[a]),!!_validateAgainst(a,l,securityRequirement({create:e,read:g,update:i,remove:k})))}},{key:"_getRoles",value:function(a){var b=[],c=!0,d=!1,e=void 0;try{for(var f,g,h=this._roles[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,g in this._positionRoles&&(a===SCOPE_ALL||0<=this._positionRoles[g].indexOf(a))&&b.push(g)}catch(a){d=!0,e=a}finally{try{!c&&h.return&&h.return()}finally{if(d)throw e}}return b}},{key:"getUserId",value:function(){return this._user_id}},{key:"getCompanyId",value:function(){return this._company_id}},{key:"getRoles",value:function(){return this._roles}},{key:"export",value:function(a){var b={userId:this._user_id,companyId:this._company_id,roles:[],positionRoles:{},permissions:{}};if(!a)return Object.assign(b.roles,this._roles),Object.assign(b.positionRoles,this._positionRoles),Object.assign(b.permissions,this._permissions),b;Object.assign(b.permissions,this._permissions);var c=!0,d=!1,e=void 0;try{for(var f,g,h=this._roles[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,g in this._positionRoles?0<=this._positionRoles[g].indexOf(a)?(b.positionRoles[g]=[a],b.roles.push(g)):delete b.permissions[g]:b.roles.push(g)}catch(a){d=!0,e=a}finally{try{!c&&h.return&&h.return()}finally{if(d)throw e}}return b}}]),a}();function securityRequirement(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=0|a.create,c=(0|a.read)<<1,d=(0|a.update)<<2,e=(0|a.remove)<<3;return b|c|d|e}function mergePermissions(a,b){return a|b}